---
import Icon from '../components/Icon.astro';

const updatedServices = [
  {
    title: "Building and Construction",
    icon: "cube",
    shortDesc: "High-precision surveys for apartment complexes, high-rise buildings, schools, and residential projects.",
    fullDesc: "With extensive experience in the building and construction sector, we deliver high-precision surveys for apartment complexes, high-rise buildings, schools, and residential projects. Understanding that each project is unique, we tailor our services to meet the specific needs of every client. From initial site datum setup to final as-constructed surveys, our team ensures accurate data and seamless execution, giving you the confidence to complete your project on time and within budget."
  },
  {
    title: "Civil Construction",
    icon: "ruler",
    shortDesc: "Expertise for road upgrades, subdivisions, bridges, pipelines, and rail projects.",
    fullDesc: "From road upgrades and subdivisions to bridges, pipelines, and rail projects, HR Surveyors offers the expertise required for your civil construction needs. Our services include control network setup, on-site set out and pickups, volume calculations, 3D modeling, and final as-built surveys. Whether you need a dedicated team of surveyors to manage your project or a one-time visit to set up, we deliver the same high-quality, reliable service every time."
  },
  {
    title: "Infrastructure & Mining",
    icon: "globe",
    shortDesc: "Managing major projects in urban and rural settings, including Australia's largest infrastructure and mining projects.",
    fullDesc: "With extensive experience in some of Australia's largest infrastructure and regional mining projects, we have the systems in place to efficiently manage your major undertaking, whether in urban or rural settings. From submitting conformance reports to handling RFIs and managing data, we ensure that all records are current, facilitating seamless project execution and on-time handover. Our highly skilled surveyors offer expert advice and reliable service, giving you the confidence you need throughout the entire project lifecycle."
  },
  {
    title: "Renewable Energy",
    icon: "sun",
    shortDesc: "Comprehensive surveying solutions for wind farms, solar farms, and battery storage facilities.",
    fullDesc: "Our Renewable Energy Infrastructure service supports the development of wind farms, solar farms, and battery storage facilities. We provide comprehensive surveying solutions, including site feasibility studies, topographic surveys, construction set-outs, and as-built documentation. With a focus on precision and efficiency, we use advanced technology to streamline project delivery and reduce environmental impact. Whether for new projects or expansions, we ensure accurate data and professional support throughout every stage."
  },
  {
    title: "Feature and Level Survey",
    icon: "layers",
    shortDesc: "Essential data collection for accurate design in development projects.",
    fullDesc: "A Feature and Level survey is a crucial step in the planning of any development project, whether for a new building, subdivision, or major construction endeavor. This type of survey provides essential data that forms the foundation for accurate design before construction begins. By establishing precise survey control to a local datum or MGA/AHD from the outset, we ensure continuity and adherence to standards throughout every aspect of the development process."
  },
  {
    title: "Laser Scanning",
    icon: "scanLine",
    shortDesc: "Advanced 3D laser scanning for detailed digital models of structures and environments.",
    fullDesc: "We utilize advanced 3D laser scanning technology to capture highly accurate spatial data of structures and environments. This non-invasive method generates detailed digital models, providing essential information for applications in architecture, construction, and heritage preservation. By rapidly gathering millions of data points, our service streamlines project planning, design, and analysis. The resulting point clouds and 3D models integrate seamlessly with various software applications, enhancing collaboration and decision-making. Trust our experienced team to deliver high-quality results tailored to your project needs."
  },
  {
    title: "UAV (Drone Survey)",
    icon: "airplane",
    shortDesc: "Cutting-edge drone technology for aerial mapping and imagery across multiple industries.",
    fullDesc: "Our UAV (Drone Survey) service utilizes cutting-edge drone technology to deliver accurate and efficient aerial mapping and imagery for various applications. This innovative approach enables us to capture high-resolution images and videos, providing essential data for informed decision-making across multiple industries. We specialize in creating detailed topographical plans, conducting stockpile volume calculations, and developing comprehensive 3D digital terrain models. Our skilled team ensures data quality and precision, facilitating informed decision-making and effective project management."
  },
  {
    title: "Utility Locating",
    icon: "utilityLocating",
    shortDesc: "Accurate underground utility location using electromagnetic induction and Ground Penetrating Radar (GPR).",
    fullDesc: "Our Utility Locating services use a combination of electromagnetic induction and Ground Penetrating Radar (GPR) to accurately locate both metallic and non-metallic underground utilities. By combining conductive, inductive, and passive locating techniques, we can quickly identify and trace utilities across large areas, even those with non-metallic lines using traceable copper rods. This approach ensures precise depth measurement without breaking ground, making it an efficient and non-invasive solution for your project needs.",
    externalLink: "https://www.hrutilities.com.au"
  }
];

const images = [
  "/images/hr-surveyors-construction-site.jpg",
  "/images/hr-surveyors-surface-mapping.jpg",
  "/images/hr-surveyors-laser-scanning.jpg",
  "/images/hr-surveyors-infrastructure-project.jpg",
];

function getAltText(src: string) {
  const filename = src.split('/').pop()?.split('.')[0] || '';
  return filename.split('-').slice(2).join(' ');
}

---

<section class="py-16 relative overflow-hidden rounded bg-hr-light-gray">
  <div class="container mx-auto px-4 relative z-10">
    <div class="flex flex-col lg:flex-row gap-12">
      <div class="lg:w-1/2">
        <h2 class="text-3xl lg:text-4xl font-bold mb-8 text-hr-dark">We deliver high-quality survey solutions tailored to your construction project.</h2>
        <div class="aspect-video bg-gray-300 rounded-lg overflow-hidden mb-8 relative" id="imageSlider" style="height: auto; padding-bottom: 56.25%;">
          {images.map((src, index) => (
            <img 
              src={src} 
              alt={`HR Surveyors in action: ${getAltText(src)}`} 
              class={`object-cover object-center w-full h-full absolute top-0 left-0 transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`}
              data-index={index}
            />
          ))}
        </div>
        <div class="flex justify-center items-center mt-8 space-x-12">
          <div class="text-center">
            <p class="text-4xl font-bold text-hr-dark">70+</p>
            <p class="text-lg text-hr-dark mt-2">Employees</p>
          </div>
          <div class="text-center">
            <p class="text-4xl font-bold text-hr-dark">5</p>
            <p class="text-lg text-hr-dark mt-2">Offices</p>
          </div>
        </div>
      </div>
      <div class="lg:w-1/2 relative">
        <div class="space-y-2 h-[600px] overflow-y-auto" id="servicesContainer">
          {updatedServices.map((service, index) => (
            <div class="bg-white rounded-lg shadow-md transition-all duration-300 group hover:bg-hr-light">
              <button 
                class="w-full text-left flex justify-between items-center px-4 py-3 service-button focus:outline-none"
                data-index={index}
              >
                <h3 class="text-base font-semibold text-hr-dark group-hover:text-hr-dark transition-colors duration-300">
                  {service.title}
                </h3>
                <Icon name={service.icon} class="icon w-5 h-5 transform transition-transform duration-300 text-hr-dark group-hover:text-hr-dark" />
              </button>
              <div class="hidden px-4 pb-3 service-content">
                <p class="text-sm text-hr-dark mb-2">{service.shortDesc}</p>
                <button class="text-sm text-hr-accent hover:underline transition-colors duration-300 learn-more-button focus:outline-none">
                  Learn more
                </button>
                <div class="hidden mt-2 text-sm text-hr-dark full-description">
                  <p>{service.fullDesc}</p>
                  {service.externalLink && (
                    <a href={service.externalLink} class="text-hr-accent hover:underline mt-2 inline-block" target="_blank" rel="noopener noreferrer">
                      Visit HR Utilities for more information
                    </a>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
        <div class="mt-4 flex justify-end">
          <a href="/services" class="text-hr-dark hover:text-hr-accent transition-colors duration-300 flex items-center group">
            <span class="mr-2 text-sm">View all our services</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  function initializeServices() {
    const servicesContainer = document.getElementById('servicesContainer');
    if (servicesContainer) {
      servicesContainer.addEventListener('click', (event) => {
        const target = event.target;
        const serviceButton = target.closest('.service-button');
        const learnMoreButton = target.closest('.learn-more-button');

        if (serviceButton) {
          const allServiceContents = servicesContainer.querySelectorAll('.service-content');
          const allIcons = servicesContainer.querySelectorAll('.icon');
          
          allServiceContents.forEach((content, index) => {
            if (content !== serviceButton.nextElementSibling) {
              content.classList.add('hidden');
              allIcons[index].classList.remove('rotate-180');
            }
          });

          const content = serviceButton.nextElementSibling;
          const icon = serviceButton.querySelector('.icon');
          
          if (content) {
            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
          }
        } else if (learnMoreButton) {
          const fullDescription = learnMoreButton.nextElementSibling;
          if (fullDescription) {
            fullDescription.classList.toggle('hidden');
            learnMoreButton.textContent = fullDescription.classList.contains('hidden') ? 'Learn more' : 'Show less';
          }
        }
      });
    }

    initializeImageSlider();
  }

  function initializeImageSlider() {
    const imageSlider = document.getElementById('imageSlider');
    const images = imageSlider ? imageSlider.querySelectorAll('img') : null;
    let currentIndex = 0;

    function showNextImage() {
      if (images && images.length > 0) {
        images[currentIndex].classList.remove('opacity-100');
        images[currentIndex].classList.add('opacity-0');
        currentIndex = (currentIndex + 1) % images.length;
        images[currentIndex].classList.remove('opacity-0');
        images[currentIndex].classList.add('opacity-100');
      }
    }

    setInterval(showNextImage, 3000);
  }

  // Run on initial load and after navigation
  document.addEventListener('astro:page-load', initializeServices);

  // Fallback for initial page load if astro:page-load doesn't fire
  document.addEventListener('DOMContentLoaded', initializeServices);
</script>

<script>
  document.addEventListener('astro:page-load', () => {
    const serviceButtons = document.querySelectorAll('.service-button');
    const learnMoreButtons = document.querySelectorAll('.learn-more-button');

    function toggleService(button: HTMLElement) {
      const content = button.nextElementSibling as HTMLElement;
      const icon = button.querySelector('.icon') as HTMLElement;
      content.classList.toggle('hidden');
      icon.classList.toggle('rotate-180');
    }

    function toggleDescription(button: HTMLElement) {
      const fullDescription = button.nextElementSibling as HTMLElement;
      fullDescription.classList.toggle('hidden');
      button.textContent = fullDescription.classList.contains('hidden') ? 'Learn more' : 'Show less';
    }

    serviceButtons.forEach(button => {
      ['click', 'touchstart'].forEach(eventType => {
        button.addEventListener(eventType, (e) => {
          e.preventDefault();
          toggleService(button as HTMLElement);
        });
      });
    });

    learnMoreButtons.forEach(button => {
      ['click', 'touchstart'].forEach(eventType => {
        button.addEventListener(eventType, (e) => {
          e.preventDefault();
          toggleDescription(button as HTMLElement);
        });
      });
    });
  });
</script>