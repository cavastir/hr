---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

const servicesEntry = (await getCollection('services'))[0];
const { services } = servicesEntry.data;

const iconMap = {
  'Precision Mapping': 'heroicons:map',
  'Drone Surveying': 'heroicons:video-camera',
  'BIM Integration': 'heroicons:building-office',
  'Environmental Analysis': 'heroicons:beaker',
};
---

<section class="py-20 bg-gradient-to-b from-gray-100 to-white">
  <div class="container mx-auto px-4">
    <h2 class="text-4xl font-bold text-center mb-16 text-hr-dark">Our Cutting-Edge Services</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      {services.map((service) => (
        <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 group">
          <div class="text-hr-accent w-12 h-12 mb-4 group-hover:scale-110 transition-transform duration-300">
            <Icon name={iconMap[service.title]} />
          </div>
          <h3 class="text-xl font-semibold mb-2 text-hr-dark">{service.title}</h3>
          <p class="text-gray-600">{service.description}</p>
          <a href={`/services/${service.title.toLowerCase().replace(/\s+/g, '-')}`} class="mt-4 inline-flex items-center text-hr-accent hover:underline">
            Learn more
            <span class="ml-1">→</span>
          </a>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  let currentPage = 1;
  const totalPages = {totalPages};
  const loadMoreButton = document.getElementById('load-more');

  loadMoreButton?.addEventListener('click', async () => {
    currentPage++;
    const response = await fetch(`/api/services?page=${currentPage}`);
    const newServices = await response.json();
    
    const servicesContainer = document.querySelector('.grid');
    newServices.forEach(service => {
      const serviceElement = createServiceElement(service);
      servicesContainer?.appendChild(serviceElement);
    });

    if (currentPage >= totalPages) {
      loadMoreButton?.remove();
    }
  });

  function createServiceElement(service) {
    const div = document.createElement('div');
    div.className = 'bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 group';
    div.innerHTML = `
      <div class="text-hr-accent text-4xl mb-4 group-hover:scale-110 transition-transform duration-300">
        ${service.data.icon}
      </div>
      <h3 class="text-xl font-semibold mb-2 text-hr-dark">${service.data.title}</h3>
      <p class="text-gray-600">${service.data.description}</p>
      <a href="/services/${service.slug}" class="mt-4 inline-flex items-center text-hr-accent hover:underline">
        Learn more
        <span class="ml-1">→</span>
      </a>
    `;
    return div;
  }
</script>